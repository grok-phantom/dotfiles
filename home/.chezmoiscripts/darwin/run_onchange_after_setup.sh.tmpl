{{- if eq .chezmoi.os "darwin" -}}
#!/bin/zsh
set -euo pipefail

domain="com.apple.symbolichotkeys"

# 说明：
# 28: Save picture of screen as a file
# 29: Save picture of selected area as a file
# 30: Copy picture of screen to the clipboard
# 31: Copy picture of selected area to the clipboard
#
# 我们只修改第三个 parameters（修饰键 mask），保留原有 keycode / layout：
#   1179648 = ⌘ + ⇧
#   1441792 = ⌘ + ⇧ + ⌃

defaults export "$domain" - | \
  # 确保启用
  plutil -replace AppleSymbolicHotKeys.28.enabled -bool YES -o - - | \
  plutil -replace AppleSymbolicHotKeys.29.enabled -bool YES -o - - | \
  plutil -replace AppleSymbolicHotKeys.30.enabled -bool YES -o - - | \
  plutil -replace AppleSymbolicHotKeys.31.enabled -bool YES -o - - | \
  # 互换：文件用 ⌘⇧⌃，剪贴板用 ⌘⇧
  plutil -replace AppleSymbolicHotKeys.28.value.parameters.2 -integer 1441792 -o - - | \
  plutil -replace AppleSymbolicHotKeys.29.value.parameters.2 -integer 1441792 -o - - | \
  plutil -replace AppleSymbolicHotKeys.30.value.parameters.2 -integer 1179648 -o - - | \
  plutil -replace AppleSymbolicHotKeys.31.value.parameters.2 -integer 1179648 -o - - | \
  defaults import "$domain" -

# 刷新缓存 & UI
killall cfprefsd 2>/dev/null || true
killall SystemUIServer 2>/dev/null || true
/System/Library/PrivateFrameworks/SystemAdministration.framework/Resources/activateSettings -u 2>/dev/null || true
{{ end }}